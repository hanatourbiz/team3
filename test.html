<body>
    <div id="loading">μ§μ› DBλ¥Ό λ¶λ¬μ¤λ” μ¤‘μ…λ‹λ‹¤...</div>

    <div class="admin-panel">
        <div class="admin-header">
            <h2 style="margin:0;">π“‹ μ „λ‹΄ μ„λΉ„μ¤ μ•λ‚΄λ¬Έ κ΄€λ¦¬ (DB μ—°λ™ν•)</h2>
            <a href="https://docs.google.com/forms/d/YOUR_FORM_ID/viewform" target="_blank" class="reg-btn">π“ μ§μ› DB λ“±λ΅/μμ • (Google Form)</a>
        </div>
        
        <div class="input-group">
            <div><label>λ°μ†΅ λ‚ μ§</label><input type="text" id="in-date" value="2026λ…„ 2μ›” 20μΌ(κΈ)" oninput="updateView()"></div>
            <div><label>μ—…μ²΄λ…</label><input type="text" id="in-client" value="LH ν•κµ­ν† μ§€μ£Όνƒκ³µμ‚¬" oninput="updateView()"></div>
            <div><label>μ—…μ²΄ λ΅κ³ </label><input type="file" onchange="loadLogo(event)"></div>
        </div>

        <div class="section-title">π‘¤ μ„λΉ„μ¤ μ΄κ΄„ λ° μμ—…κ΄€λ¦¬ μ„ νƒ</div>
        <div class="input-group" id="mgt-select-area">
            </div>

        <div class="section-title">βοΈ ν•­κ³µ μ„λΉ„μ¤ν€ μ„ νƒ</div>
        <div class="input-group" id="air-select-area"></div>

        <div class="section-title">π¨ νΈν…” & π›‚ λΉ„μ μ„λΉ„μ¤ν€ μ„ νƒ</div>
        <div class="input-group" id="etc-select-area"></div>
        
        <button class="print-btn" onclick="window.print()">π–¨οΈ μ„ νƒλ λ‚΄μ©μΌλ΅ μ•λ‚΄λ¬Έ μΈμ‡„</button>
    </div>

    <div class="page">
        </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbz3_3GbX94yOQwY8poSX0iLX_71QCNPJ8NaI6mpERZiArnlmkYrpDnVsb6BDpPxIzZdTg/exec';
        let globalStaffDB = []; // μ‹νΈμ—μ„ κ°€μ Έμ¨ μ „μ²΄ λ°μ΄ν„°

        async function initSystem() {
            try {
                const response = await fetch(API_URL);
                globalStaffDB = await response.json();
                
                // κ° μ„Ήμ…λ³„λ΅ μ…€λ ‰νΈ λ°•μ¤ 3κ°μ”© μƒμ„±
                createSelectors('mgt-select-area', 'μ„λΉ„μ¤ μ΄κ΄„', 3);
                createSelectors('air-select-area', 'ν•­κ³µ λ‹΄λ‹Ή', 3);
                createSelectors('etc-select-area', 'κΈ°νƒ€(νΈν…”/λΉ„μ λ“±)', 3);
                
                document.getElementById('loading').style.display = 'none';
            } catch (e) {
                alert('DB λ΅λ“ μ‹¤ν¨! μ›Ή μ•± URLκ³Ό μ‹νΈ κ¶ν•μ„ ν™•μΈν•΄ μ£Όμ„Έμ”.');
            }
        }

        function createSelectors(containerId, category, count) {
            const container = document.getElementById(containerId);
            const filteredStaff = globalStaffDB.filter(s => (s['λ‹΄λ‹Ή κµ¬λ¶„'] || s['λ‹΄λ‹Ήκµ¬λ¶„']) === category);

            for (let i = 1; i <= count; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label>${category} ${i}</label>
                    <select onchange="updateStaffCard('${category}', ${i}, this.value)">
                        <option value="">λ‹΄λ‹Ήμ μ„ νƒ</option>
                        ${filteredStaff.map(s => `<option value="${encodeURIComponent(JSON.stringify(s))}">${s['μ„±ν•¨']} ${s['μ§μ±…']}</option>`).join('')}
                    </select>
                `;
                container.appendChild(div);
            }
        }

        function updateStaffCard(category, index, staffDataJson) {
            if (!staffDataJson) return;
            const staff = JSON.parse(decodeURIComponent(staffDataJson));
            
            // μ•λ‚΄λ¬Έ ν•λ‹¨ μΉ΄λ“ μμ—­ ID λ§¤μΉ­ (κΈ°μ΅΄ λ΅μ§ ν™μ©)
            const viewMap = { 'μ„λΉ„μ¤ μ΄κ΄„': 'view-mgt', 'ν•­κ³µ λ‹΄λ‹Ή': 'view-air', 'κΈ°νƒ€(νΈν…”/λΉ„μ λ“±)': 'view-etc' };
            const container = document.getElementById(viewMap[category]);
            
            // μ‹¤μ  μΉ΄λ“ μƒμ„± λ° μ—…λ°μ΄νΈ λ΅μ§... (μ΄ν• μƒλµ)
        }

        window.onload = initSystem;
    </script>
</body>
